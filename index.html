<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>incre_ment | gallery</title>
  <style>
    body { background-color: #0a0a0a; color: #f0f0f0; font-family: sans-serif; margin: 0; padding: 40px 20px; }
    
    /* Header & Metadata Styling */
    header { text-align: center; margin-bottom: 40px; }
    h1 { font-weight: 200; letter-spacing: 10px; text-transform: uppercase; margin-bottom: 10px; }
    
    .header-metadata {
      font-family: monospace;
      font-size: 0.7rem;
      color: #888;
      letter-spacing: 2px;
      word-spacing: 5px;
      text-transform: uppercase;
    }

    /* Terminal Navigation */
    nav {
      text-align: center;
      margin-bottom: 60px;
      font-family: monospace;
    }

    .nav-link {
      color: #444;
      text-decoration: none;
      margin: 0 15px;
      font-size: 0.8rem;
      letter-spacing: 2px;
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid transparent;
      padding: 5px 10px;
    }

    .nav-link:hover, .nav-link.active {
      color: #fff;
      border: 1px solid #333;
      background: #111;
    }

    .status-active {
      color: #ccc;
      font-weight: bold;
      animation: pulse 3s infinite ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.4; }
    }
    
    /* Gallery Grid */
    .gallery { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); 
      gap: 30px; 
      max-width: 1400px; 
      margin: 0 auto;
      transition: opacity 0.2s ease;
    }

    .card { background: #151515; border: 1px solid #222; border-radius: 4px; overflow: hidden; display: flex; flex-direction: column; }
    
    canvas { 
      width: 100%; 
      aspect-ratio: 16 / 9; 
      display: block; 
      background-color: #000; 
    }
    
    .card-info { padding: 15px; border-top: 1px solid #222; position: relative; }
    .card-title { font-size: 0.9rem; margin: 0; color: #ddd; letter-spacing: 1px; }

    .card-link {
      display: inline-block;
      margin-top: 8px;
      font-size: 0.7rem;
      color: #666;
      text-decoration: none;
      letter-spacing: 1px;
      text-transform: uppercase;
      transition: color 0.3s ease;
    }

    .card-link:hover { color: #fff; }

    .fps-counter {
      position: absolute;
      top: 15px;
      right: 15px;
      font-family: monospace;
      font-size: 0.7rem;
      color: #666;
      opacity: 0.8;
      letter-spacing: 0.5px;
      text-align: right;
    }
  </style>
</head>
<body>

  <header>
    <h1>incre_ment</h1>
    <div class="header-metadata">
      STATUS: <span class="status-active">ACTIVE</span> // 
      GPU_LOAD: STABLE // 
      NODES: 04 // 
      <span id="current-date">0000.00.00</span>
    </div>
  </header>

  <nav id="bank-nav">
    <span class="nav-link active" onclick="switchBank('BANK_01')">[ BANK_01 ]</span>
    <span class="nav-link" onclick="switchBank('BANK_02')">[ BANK_02 ]</span>
  </nav>

  <main class="gallery" id="mainframe-grid">
    </main>

  <script type="module">
    // --- Configuration: Memory Banks ---
    const memoryBanks = {
      "BANK_01": [
//        { id: "triangles", title: "001: LOADING LOADING LOADING", file: "triangles.frag", link: "lc3cRN" },
        { id: "wavycube", title: "007: GEOMETRIC VOID", file: "wavycube.frag", link: "lc3cRN" },
        { id: "tunnel", title: "002: DARKNESS CONDUIT MARK II", file: "tunnel.frag", link: "Wc3yRr" },
        { id: "noiserings", title: "003: SIMPLEX NOISE RINGS", file: "noiseRings.frag", link: "M3XBz4" },
        { id: "starfield", title: "004: A RIPPLE ACROSS", file: "starfield.frag", link: "43lyzH" }
      ],
      "BANK_02": [
        { id: "city", title: "005: PARALLAX CITYSCAPE", file: "city.frag", link: "l32yDc" },
        { id: "geo", title: "006: PATH DRAW", file: "geo.frag", link: "XcdGzS" },
        { id: "wavycube", title: "007: GEOMETRIC VOID", file: "wavycube.frag", link: "lc3cRN" },
        { id: "ringfall", title: "008: FALLING RINGS", file: "ringfall.frag", link: "w3lfzl" }
      ]
    };

    let activeAnimationFrames = [];

    // --- Bank Switching Logic ---
    async function switchBank(bankKey) {
      const grid = document.getElementById('mainframe-grid');
      
      // Update UI state
      document.querySelectorAll('.nav-link').forEach(link => {
        link.classList.toggle('active', link.innerText.includes(bankKey));
      });

      // 1. Visual "Flicker" effect
      grid.style.opacity = '0';

      // 2. Cleanup: Stop all current shader loops
      activeAnimationFrames.forEach(id => cancelAnimationFrame(id));
      activeAnimationFrames = [];

      // 3. Re-index Cluster
      setTimeout(async () => {
        grid.innerHTML = '';
        
        const shaders = memoryBanks[bankKey];
        for (const data of shaders) {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <canvas id="canvas-${data.id}"></canvas>
            <div class="card-info">
              <p class="card-title">${data.title}</p>
              <div class="fps-counter" id="fps-canvas-${data.id}">-- FPS · --ms</div>
              <a href="https://www.shadertoy.com/view/${data.link}" target="_blank" class="card-link">View on Shadertoy →</a>
            </div>
          `;
          grid.appendChild(card);
          initShader(`canvas-${data.id}`, data.file);
        }
        grid.style.opacity = '1';
      }, 200);
    }

    // --- Master Shader Engine ---
    async function initShader(canvasId, fragFileName) {
      const canvas = document.getElementById(canvasId);
      const fpsDisplay = document.getElementById(`fps-${canvasId}`);
      const gl = canvas.getContext('webgl');
      if (!gl) return;

      const response = await fetch(`shaders/${fragFileName}`);
      const fragmentSource = await response.text();
      const vertexSource = `attribute vec2 position; void main() { gl_Position = vec4(position, 0.0, 1.0); }`;

      function createShader(gl, type, source) {
        const s = gl.createShader(type);
        gl.shaderSource(s, source);
        gl.compileShader(s);
        if (!gl.getShaderParameter(s, gl.COMPILE_STATUS)) console.error(gl.getShaderInfoLog(s));
        return s;
      }

      const program = gl.createProgram();
      gl.attachShader(program, createShader(gl, gl.VERTEX_SHADER, vertexSource));
      gl.attachShader(program, createShader(gl, gl.FRAGMENT_SHADER, fragmentSource));
      gl.linkProgram(program);
      gl.useProgram(program);

      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);
      const pos = gl.getAttribLocation(program, "position");
      gl.enableVertexAttribArray(pos);
      gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

      const timeLoc = gl.getUniformLocation(program, "u_time");
      const resLoc = gl.getUniformLocation(program, "u_resolution");

      let lastTime = 0;
      let frameCount = 0;
      let lastFpsUpdate = 0;

      function render(time) {
        const deltaTime = time - lastTime;
        lastTime = time;
        frameCount++;

        if (time - lastFpsUpdate > 500) {
          const fps = Math.round((frameCount * 1000) / (time - lastFpsUpdate));
          fpsDisplay.innerText = `${fps} FPS · ${deltaTime.toFixed(1)}ms`;
          lastFpsUpdate = time;
          frameCount = 0;
        }

        if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {
          canvas.width = canvas.clientWidth;
          canvas.height = canvas.clientHeight;
        }
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.uniform1f(timeLoc, time * 0.001);
        gl.uniform2f(resLoc, canvas.width, canvas.height);
        gl.drawArrays(gl.TRIANGLES, 0, 6);
        
        const frameId = requestAnimationFrame(render);
        activeAnimationFrames.push(frameId);
      }
      requestAnimationFrame(render);
    }

    // --- Initialization ---
    window.switchBank = switchBank; // Expose to global scope for onclick
    switchBank('BANK_01');

    const dateDisplay = document.getElementById('current-date');
    dateDisplay.innerText = new Date().toISOString().slice(0, 10).replace(/-/g, '.');
  </script>
</body>
</html>
