<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>incre_ment | procedural gallery</title>
  <style>
    body { background-color: #0a0a0a; color: #f0f0f0; font-family: sans-serif; margin: 0; padding: 40px 0; overflow-x: hidden; }
    
    header { text-align: center; margin-bottom: 40px; padding: 0 20px; }
    h1 { font-weight: 200; letter-spacing: 10px; text-transform: uppercase; margin-bottom: 10px; }
    
    .header-metadata { font-family: monospace; font-size: 0.7rem; color: #888; letter-spacing: 2px; text-transform: uppercase; }
    .status-active { color: #f0f0f0; font-weight: bold; animation: pulse 3s infinite ease-in-out; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }

    nav { text-align: center; margin-bottom: 60px; font-family: monospace; z-index: 10; position: relative; }
    .nav-link { color: #444; text-decoration: none; margin: 0 10px; font-size: 0.8rem; letter-spacing: 2px; transition: all 0.3s ease; cursor: pointer; border: 1px solid transparent; padding: 5px 10px; display: inline-block; }
    .nav-link:hover, .nav-link.active { color: #fff; border: 1px solid #333; background: #111; }

    /* Side Navigation Buttons */
    .bank-arrow {
      position: fixed;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: #222;
      font-size: 3rem;
      font-weight: 100;
      cursor: pointer;
      padding: 20px;
      transition: all 0.3s ease;
      z-index: 100;
      user-select: none;
    }
    .bank-arrow:hover { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
    .arrow-left { left: 10px; }
    .arrow-right { right: 10px; }

    /* Gallery Grid */
    .gallery { 
      display: grid; 
      grid-template-columns: repeat(auto-fit, minmax(min(450px, 100%), 1fr)); 
      gap: 30px; 
      max-width: 1400px; 
      margin: 0 auto;
      padding: 0 60px; 
      transition: opacity 0.3s ease;
      box-sizing: border-box;
    }

    .card { background: #151515; border: 1px solid #222; border-radius: 4px; overflow: hidden; display: flex; flex-direction: column; position: relative; width: 100%; }
    canvas { width: 100%; aspect-ratio: 16 / 9; display: block; background-color: #000; }
    
    .card-info { padding: 15px; border-top: 1px solid #222; position: relative; }
    .card-title { font-size: 0.9rem; margin: 0; color: #ddd; letter-spacing: 1px; }
    .card-link { display: inline-block; margin-top: 8px; font-size: 0.7rem; color: #666; text-decoration: none; text-transform: uppercase; transition: color 0.3s ease; }
    .card-link:hover { color: #fff; }

    .fps-counter { position: absolute; top: 15px; right: 15px; font-family: monospace; font-size: 0.7rem; color: #666; opacity: 0.8; }

    footer { margin-top: 80px; text-align: center; font-family: monospace; border-top: 1px solid #222; padding: 40px 20px; }
    .cmd-link { color: #888; text-decoration: none; padding: 5px 12px; transition: all 0.2s ease; font-size: 0.75rem; cursor: pointer; border: 1px solid transparent; }
    .cmd-link:hover { color: #000; background: #f0f0f0; }

    /* Mobile Responsive */
    @media (max-width: 700px) {
      .bank-arrow { font-size: 2rem; padding: 10px; background: rgba(10,10,10,0.5); border-radius: 50%; }
      .gallery { padding: 0 15px; grid-template-columns: 1fr; }
      .card-info { display: flex; flex-direction: column; gap: 5px; }
      .fps-counter { position: static; text-align: left; opacity: 0.5; font-size: 0.6rem; }
    }
  </style>
</head>
<body>

  <button class="bank-arrow arrow-left" onclick="cycleBank(-1)">&#8249;</button>
  <button class="bank-arrow arrow-right" onclick="cycleBank(1)">&#8250;</button>

  <header>
    <h1>incre_ment</h1>
    <div class="header-metadata">STATUS: <span class="status-active">ACTIVE</span> // GPU_LOAD: STABLE // <span id="current-date">0000.00.00</span></div>
  </header>

  <nav id="bank-nav">
    <span class="nav-link active" onclick="setBank(0)">[ BANK_01 ]</span>
    <span class="nav-link" onclick="setBank(1)">[ BANK_02 ]</span>
    <span class="nav-link" onclick="setBank(2)">[ BANK_03 ]</span>
  </nav>

  <main class="gallery" id="mainframe-grid"></main>

  <footer>
    <a class="cmd-link" onclick="runContactProtocol()">CONTACT_PROTOCOL</a>
  </footer>

  <script type="module">
    const banks = ["BANK_01", "BANK_02", "BANK_03"];
    let currentBankIndex = 0;

    const memoryBanks = {
      "BANK_01": [
        { id: "triangles", title: "001: LOADING LOADING LOADING", file: "triangles.frag", link: "lc3cRN" },
        { id: "tunnel", title: "002: DARKNESS CONDUIT MARK II", file: "tunnel.frag", link: "Wc3yRr" },
        { id: "noiserings", title: "003: SIMPLEX NOISE RINGS", file: "noiseRings.frag", link: "M3XBz4" },
        { id: "starfield", title: "004: A RIPPLE ACROSS", file: "starfield.frag", link: "43lyzH" }
      ],
      "BANK_02": [
        { id: "city", title: "005: PARALLAX CITYSCAPE", file: "city.frag", link: "l32yDc" },
        { id: "geo", title: "006: PATH DRAW", file: "geo.frag", link: "XcdGzS" },
        { id: "vortex", title: "007: VORTEX EXPERIMENT", file: "vortex.frag", link: "DsK3Wz" },
        { id: "block", title: "008: BLOCK TRANSFER", file: "blocks.frag", link: "4fKGWD" }
      ],
      "BANK_03": [
        { id: "grass", title: "009: MIDNIGHT FLOW", file: "grass.frag", link: "M3jyRV" },
        { id: "blockfall", title: "010: BLOCK FALL", file: "blockfall.frag", link: "X3cyz2" },
        { id: "rain", title: "011: PRIMITIVE RAIN", file: "rain.frag", link: "lXXXWr" },
        { id: "wavycube", title: "012: WAVY CUBE", file: "wavy_cube.frag", link: "WfXGRX" }
      ]
    };

    let activeFrames = [];

    function setBank(index) {
      currentBankIndex = index;
      const bankKey = banks[currentBankIndex];
      const grid = document.getElementById('mainframe-grid');
      
      document.querySelectorAll('.nav-link').forEach((link, i) => {
        link.classList.toggle('active', i === index);
      });

      grid.style.opacity = '0';
      activeFrames.forEach(id => cancelAnimationFrame(id));
      activeFrames = [];

      setTimeout(() => {
        grid.innerHTML = '';
        memoryBanks[bankKey].forEach(data => {
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <canvas id="canvas-${data.id}"></canvas>
            <div class="card-info">
              <p class="card-title">${data.title}</p>
              <div class="fps-counter" id="fps-canvas-${data.id}">[ -- FPS ]</div>
              <a href="https://www.shadertoy.com/view/${data.link}" target="_blank" class="card-link">View Source â†’</a>
            </div>
          `;
          grid.appendChild(card);
          initShader(`canvas-${data.id}`, data.file);
        });
        grid.style.opacity = '1';
      }, 300);
    }

    function cycleBank(dir) {
      let newIndex = currentBankIndex + dir;
      if (newIndex < 0) newIndex = banks.length - 1;
      if (newIndex >= banks.length) newIndex = 0;
      setBank(newIndex);
    }

    async function initShader(canvasId, fragFileName) {
      const canvas = document.getElementById(canvasId);
      const gl = canvas.getContext('webgl');
      if (!gl) return;
      gl.getExtension('OES_standard_derivatives');

      const response = await fetch(`shaders/${fragFileName}`);
      const fragmentSource = await response.text();
      const vertexSource = `attribute vec2 position; void main() { gl_Position = vec4(position, 0.0, 1.0); }`;

      const program = gl.createProgram();
      const vs = gl.createShader(gl.VERTEX_SHADER);
      gl.shaderSource(vs, vertexSource); gl.compileShader(vs);
      const fs = gl.createShader(gl.FRAGMENT_SHADER);
      gl.shaderSource(fs, fragmentSource); gl.compileShader(fs);
      gl.attachShader(program, vs); gl.attachShader(program, fs);
      gl.linkProgram(program); gl.useProgram(program);

      const buffer = gl.createBuffer();
      gl.bindBuffer(gl.ARRAY_BUFFER, buffer);
      gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([-1,-1, 1,-1, -1,1, -1,1, 1,-1, 1,1]), gl.STATIC_DRAW);
      const pos = gl.getAttribLocation(program, "position");
      gl.enableVertexAttribArray(pos);
      gl.vertexAttribPointer(pos, 2, gl.FLOAT, false, 0, 0);

      const timeLoc = gl.getUniformLocation(program, "u_time");
      const resLoc = gl.getUniformLocation(program, "u_resolution");

      let lastFpsUpdate = 0;
      let frames = 0;

      function render(time) {
        if (!document.getElementById(canvasId)) return;
        frames++;
        if (time - lastFpsUpdate > 1000) {
          const fpsDisplay = document.getElementById(`fps-${canvasId}`);
          if (fpsDisplay) fpsDisplay.innerText = `[ ${frames} FPS ]`;
          frames = 0; lastFpsUpdate = time;
        }

        if (canvas.width !== canvas.clientWidth || canvas.height !== canvas.clientHeight) {
          canvas.width = canvas.clientWidth; canvas.height = canvas.clientHeight;
        }
        gl.viewport(0, 0, canvas.width, canvas.height);
        gl.uniform1f(timeLoc, time * 0.001);
        gl.uniform2f(resLoc, canvas.width, canvas.height);
        gl.drawArrays(gl.TRIANGLES, 0, 6);
        activeFrames.push(requestAnimationFrame(render));
      }
      activeFrames.push(requestAnimationFrame(render));
    }

    function runContactProtocol() {
      const email = "kgrx@protonmail.com";
      window.location.href = "mailto:" + email;
    }

    window.setBank = setBank;
    window.cycleBank = cycleBank;
    window.runContactProtocol = runContactProtocol;
    setBank(0);
    document.getElementById('current-date').innerText = new Date().toISOString().slice(0,10).replace(/-/g,'.');
  </script>
</body>
</html>
